# ROS端控制计划指导

一.ROS发送数据格式：“TPY:XXX TPP:XXX TVY:XXX TVP:XXX TE:XX TPID:XX TD:XX”，控制变量格式定义在MotorCommand.msg中实现,包含angle_auto，speed_auto，pid_auto

二.esp32_bridge.py功能：
1.每10秒发送一次“PING”心跳。

2.定义“/esp32/control_strategy”订阅者话题
当pid_auto为1，如果angle_auto值为1则切换为角度定控任务1，如果speed_auto值为1则切换为速度定控任务1，如果都为1，则也为角度控制任务，如果都为0，则正常等待接收“/esp32/motor_cmd”话题的消息。
角度定控任务1：让Yaw轴电机正转36度，速度为36度每秒，同时Pitch轴电机正转90度，速度为180度每秒，完成后让Yaw轴电机反转36度，速度为36度每秒，同时Pitch轴电机反转90度，速度为180度每秒。
速度定控任务1：Yaw轴10秒一个转动周期，一个周期内，Yaw轴保持36度每秒的速度，从原点转至正180度后再转回原点；Pitch轴2秒一个转动周期，一个周期内，Pitch轴从原点先正转90度，再反转90度，再反转90度，再正转90度;Yaw轴和Pitch轴严格时间同步转动，即Yaw转1个周期，Pitch转5个周期

当pid_auto为0，如果angle_auto值为1则切换为角度pid定控任务1，如果speed_auto值为1则切换为速度pid定控任务1，如果都为1，则也为角度控制任务，如果都为0，则正常等待接收“/esp32/motor_cmd”话题的消息。
角度pid定控任务1：控制Yaw轴电机转至-60度，速度为30度每秒，同时Pitch轴电机转至-90度，速度为45度每秒，完成后让Yaw轴电机转至-120度，速度为30度每秒，同时Pitch轴电机转至0度，速度为45度每秒。
速度pid定控任务1：控制Yaw轴电机转至-60度，-120度，-180度（即180度），120度，60度，0度，速度为30度每秒，循环执行，同时Pitch轴电机转至-90度，0度，速度为45度每秒，循环执行

3.假设电机速度准确，能够根据所发送的控制指令和控制时间，计算当前电机运行的总角度（角度范围转化为-180-180度），实时保存到电机姿态数据文本中

4.每次启动该程序后，从键盘读取字符串指令，回车确认，若读取到R，则读取电机姿态数据文本，然后让电机以最短路径回到原点；若读取到K，则清空电机姿态数据，并将当前位置设为原点

三.test_motor_control.py功能：
1.首先进行角度定控任务1，等待任务完成，暂停电机5秒，然后切换速度定控任务1运行10秒，再暂停电机5秒
2.接着进行角度pid定控任务，等待任务完成，暂停电机5秒，然后切换速度pid定控任务运行12秒，再暂停电机5秒
3.最后以你的理解方法控制电机绘制一个心形轨迹，要求Pitch轴电机角度不能超过正负90度
4.当退出执行当前程序的终端时，马上暂停电机

四.motor_control.py功能：
1.直接执行速度定控任务1
2.当退出执行当前程序的终端时，马上暂停电机